<html><head><link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/font-roboto/roboto.html">
<link rel="import" href="../../bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="../../bower_components/paper-dialog-behavior/paper-dialog-behavior.html">
<link rel="import" href="../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../bower_components/iron-list/iron-list.html">
<link rel="import" href="../../bower_components/geo-location/geo-location.html">
<link rel="import" href="../../bower_components/google-map/google-map.html">
<link rel="import" href="../../bower_components/google-map/google-map-search.html">
<link rel="import" href="../../bower_components/google-map/google-map-marker.html">

</head><body><dom-module id="search-results">
  <template>
    <style>
      :host {
        font-family: "Montserrat";
        --app-primary-color: #ee5c56;
        --app-secondary-color: #525262;
        --section-bg-grey: #f1f1f1;
      }
      
      paper-dialog {
        width: 100%;
        max-width: 80vw;
        font-family: "Montserrat";
      }

      paper-dialog .contents {
        display: flex;
      }

      .title h2 {
        /*padding-bottom: 40px;*/
        font-size: 2.5em;
        font-weight: 800;
        text-align: center;
      }

      span.accent {
        color: var(--app-primary-color);
      }

      paper-input.med-search-input {
        --paper-input-container-input: {
          background-color: var(--section-bg-grey);
          padding: 10px 20px;
          --secondary-text-color: var(--app-secondary-color);
        }
        
        --paper-input-container-color: {
          color: var(--app-secondary-color);
        }

        --secondary-text-color: var(--app-secondary-color);
        
        --paper-input-container-underline: {
            display: none
          }
        --paper-input-container-underline-focus: {
            display: none
          }
        --paper-input-container-underline-disabled: {
            display: none
          }
      }
      
      .results-header {
        align-items: center;
        list-style: none;
        display: flex;
        padding: 0px;
        margin-bottom: 0px;
      }

      .results-header li {
        flex: 1 1 auto;
        font-size: 1.5em;
        font-weight: 600;
        line-height: 2;
      }
      
      .search-result-list {
        flex: 0 1 35%;
        padding: 0 20px;
      }

      .search-result-list label {
        color: #a8a8b0;
      }

      .search-result-list-item {
        /*padding: 16px 0px;*/
      }

      .search-result-list-item ul {
        /*padding: 16px 0px;*/
        align-items: center;
        border-top: 1px solid var(--section-bg-grey);
        display: flex;
        height: 100%;
        list-style: none;
        margin: 0px;
        padding: 0;
        width: 100%;
      }

      .search-result-list-item li {
        flex: 1 1 auto;
        align-items: center;
      }

      .search-result-list-item li.accent { 
        color: var(--app-primary-color);
      }
      
      .search-result-list-item h3 {
        margin: 0px;
        padding: 0px;
      }

      .status-bar {
        margin: 20px 0px;
      }

      google-map {
        flex: 1 1 65%;
        height: 600px;
      }
    </style>
    <!--<paper-dialog id="searchResults" with-backdrop=true>-->
    <paper-dialog id="searchResults" on-iron-overlay-opened="requestLocation">
      <div class="title">
        <h2><span class="accent">care</span>card</h2>
      </div>
      <div class="contents">
        <div class="search-result-list">
          <paper-input class="med-search-input" placeholder="Type prescription name"></paper-input>
          <div class="status-bar">
            <label>Showing results for:</label>
            <div id="medicationName">{{medName}}</div>
          </div>
          <ul class="results-header">
            <li>Pharmacy</li>
            <li>Savings</li>
          </ul>
          <iron-list items="[[results]]" max-physical-count="5">
                    <template>
                      <div class="search-result-list-item" style="height: 70px;">
                        <ul>
                          <li>
                            <h3>{{item.name}}</h3>
                            <span>(0.3 Miles Away)</span>
                          </li>
                          <li class="accent">
                            <h3>$14.04</h3>
                            <span>With CareCard</span>
                          </li>
                        </ul>
                      </div>
                    </template>
  </iron-list>
  </div>
  <!--<google-map-search map="[[map]]" query="pharmacy" results="{{mapSearch}}" on-google-map-search-results="updateSearchResults">
  </google-map-search>-->
  <geo-location latitude="{{lat}}" longitude="{{lng}}" idle="true"></geo-location>
  <google-map latitude="[[lat]]" longitude="[[lng]]" api-key="AIzaSyCdH_BQxHpwDJV_ySsUxq0iQ6JWCQlDYI8" disable-default-ui="">
    <google-map-marker latitude="[[lat]]" longitude="[[lng]]"></google-map-marker>
  </google-map>
  <!-- <google-map map="{{map}}" api-key="AIzaSyCdH_BQxHpwDJV_ySsUxq0iQ6JWCQlDYI8" fit-to-markers disable-default-ui>
  <template is="dom-repeat" items="[[results]]" as="marker" indexAs="{{marker.placeId}}">
      <google-map-marker latitude="[[marker.latitude]]"
                         longitude="[[marker.longitude]]" title="[[marker.name]]">
        <h2>[[marker.name]]</h2>
        <span>[[marker.formatted_address]]</span>
      </google-map-marker>
    </template>
  </google-map>-->

  </div>
  </paper-dialog>
  </template>

  <script>
    Polymer({

      is: 'search-results',
      properties: {
        medName: {
          type: String,
          value: function() {
            return "Lipitor";
          }
        },
        results: {
          type: Object,
          value: []
        },
        mapSearch: {
          type: Object,
          value: []
        }
      },
      observers: [

      ],

      attached: function() {
        console.log("search results loaded");
        let map = document.querySelector("search-results google-map");
        let mapComponent = this;
        if (map) {
          map.addEventListener("google-map-ready", (e) => {
            console.log("google map is ready.");
            // mapComponent.requestLocation();
          })
        }
      },

      _equal: function(value1, value2) {
        return value1 === value2;
      },

      openDialog: function() {
        console.log("opening dialog");
        this.paperDialog.open();
      },

      requestLocation: function() {
        document.querySelector("app-header").hidden = true;
        let locator = document.querySelector("search-results geo-location") || null;
        if (locator) {
          locator.idle = false;
          locator.fetch();
        }
      },

      geocodeZip: function() {
        var geocoder = new google.maps.Geocoder();
        let zipInput = document.querySelector("#splash input.zipcode") || null;
        let zipCode = zipInput ? zipInput.value : "10012";
        let map = document.querySelector("search-results google-map").map;
        let searchComponent = document.querySelector("search-results google-map-search");
        let {
          latitude: searchLatitude,
          longitude: searchLongitude
        } = searchComponent;

        geocoder.geocode({
            address: zipCode
          },
          function(results, status) {
            if (status == 'OK') {
              let {
                latitude,
                longitude
              } = results[0].geometry.location;
              map.setCenter(results[0].geometry.location);
              var marker = new google.maps.Marker({
                map: map,
                position: results[0].geometry.location
              });
              searchLatitude = latitude;
              searchLongitude = longitude;
              searchComponent.search("pharmacies");
            } else {
              alert('Geocode was not successful for the following reason: ' + status);
            }
          }
        );
      },
      updateSearchResults: function(event, results) {
        this.results = results;
      }

    });
  </script>
</dom-module></body></html>